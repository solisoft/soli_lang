{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Soli MVC LiveView Convention",
  "description": "Machine-readable conventions for Soli LiveView real-time reactive components",
  "type": "object",
  "properties": {
    "overview": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string",
          "content": "LiveView enables real-time reactive UI components without writing JavaScript. State is managed server-side and synchronized via WebSocket connections."
        },
        "benefits": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "content": [
            "No JavaScript required for interactive components",
            "Server-side state management",
            "Real-time updates via WebSocket",
            "Progressive enhancement friendly",
            "Automatic reconnection handling"
          ]
        }
      }
    },
    "fileStructure": {
      "type": "object",
      "properties": {
        "template": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "pattern": "app/views/live/{component_name}.sliv"
            },
            "extension": {
              "type": "string",
              "pattern": ".sliv"
            },
            "directory": {
              "type": "string",
              "pattern": "app/views/live/"
            }
          }
        },
        "controller": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "pattern": "app/controllers/live_controller.sl"
            },
            "description": {
              "type": "string",
              "content": "Single live_controller.sl handles all LiveView event routing"
            }
          }
        },
        "registration": {
          "type": "object",
          "properties": {
            "file": {
              "type": "string",
              "pattern": "config/routes.sl"
            },
            "syntax": {
              "type": "string",
              "pattern": "router_live('component_name', 'ControllerLive')"
            },
            "examples": [
              "router_live(\"counter\", \"CounterLive\")",
              "router_live(\"metrics\", \"MetricsLive\")",
              "router_live(\"chat\", \"ChatLive\")"
            ]
          }
        }
      }
    },
    "templateSyntax": {
      "type": "object",
      "properties": {
        "stateVariables": {
          "type": "object",
          "properties": {
            "syntax": {
              "type": "string",
              "pattern": "@variable_name"
            },
            "examples": [
              "@count",
              "@username",
              "@is_visible"
            ],
            "description": "State variables are accessed with @ prefix in templates"
          }
        },
        "directives": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "syntax": {
                "type": "string",
                "pattern": "soli-{event}=\"handler_name\""
              },
              "description": {
                "type": "string"
              }
            }
          },
          "content": [
            {
              "name": "click",
              "syntax": "soli-click=\"increment\"",
              "description": "Handle click events on elements"
            },
            {
              "name": "change",
              "syntax": "soli-change=\"update_value\"",
              "description": "Handle input/select change events"
            },
            {
              "name": "submit",
              "syntax": "soli-submit=\"submit_form\"",
              "description": "Handle form submissions"
            },
            {
              "name": "keyup",
              "syntax": "soli-keyup=\"handle_key\"",
              "description": "Handle keyboard events"
            },
            {
              "name": "mount",
              "syntax": "soli-mount=\"initialize\"",
              "description": "Execute handler when component mounts"
            },
            {
              "name": "update",
              "syntax": "soli-update=\"check_changes\"",
              "description": "Execute handler when state updates"
            }
          ]
        },
        "conditionals": {
          "type": "object",
          "properties": {
            "syntax": {
              "type": "string",
              "pattern": "<% if condition %> ... <% end %>"
            },
            "examples": [
              "<% if @count > 0 %>",
              "<% elsif @status == \"active\" %>",
              "<% else %>"
            ],
            "description": "Conditional rendering using ERB-style tags"
          }
        },
        "loops": {
          "type": "object",
          "properties": {
            "syntax": {
              "type": "string",
              "pattern": "<% for item in collection %> ... <% end %>"
            },
            "examples": [
              "<% for user in @users %>",
              "<% for item in @items %>"
            ],
            "description": "Iterate over collections in templates"
          }
        }
      }
    },
    "eventHandling": {
      "type": "object",
      "properties": {
        "functionSignature": {
          "type": "string",
          "pattern": "fn handler_name(event: Any) -> Any"
        },
        "eventProperties": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "content": [
            "event[\"event\"] - name of the triggered event",
            "event[\"state\"] - current component state",
            "event[\"target\"] - DOM element that triggered event",
            "event[\"value\"] - value from input elements"
          ]
        },
        "returnFormat": {
          "type": "object",
          "properties": {
            "state": {
              "type": "string",
              "pattern": "{ \"state\": { \"key\": value } }",
              "description": "Update state by returning new state hash"
            },
            "effects": {
              "type": "string",
              "pattern": "{ \"effects\": [...] }",
              "description": "Optional effects for client-side actions"
            }
          }
        },
        "examples": [
          {
            "description": "Counter increment handler",
            "code": "fn increment(event: Any) -> Any {\n    let count = event[\"state\"][\"count\"] ?? 0;\n    return { \"state\": { \"count\": count + 1 } };\n}"
          },
          {
            "description": "Form submission handler",
            "code": "fn submit_form(event: Any) -> Any {\n    let data = event[\"value\"];\n    return { \"state\": { \"submitted\": true, \"data\": data } };\n}"
          }
        ]
      }
    },
    "stateManagement": {
      "type": "object",
      "properties": {
        "initialState": {
          "type": "object",
          "properties": {
            "description": {
              "type": "string",
              "content": "State can be initialized in the event handler when event[\"state\"] is null"
            },
            "example": {
              "type": "string",
              "content": "let count = event[\"state\"][\"count\"] ?? 0;"
            }
          }
        },
        "updates": {
          "type": "object",
          "properties": {
            "description": {
              "type": "string",
              "content": "State updates are returned from event handlers and automatically synced to client"
            },
            "mergeBehavior": {
              "type": "string",
              "content": "New state is shallowly merged with existing state"
            }
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "description": {
              "type": "string",
              "content": "State can be persisted to session or database for continuity across requests"
            },
            "methods": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "content": [
                "session.set(\"live_state\", state)",
                "db.update(\"live_sessions\", session_id, { state: state })"
              ]
            }
          }
        }
      }
    },
    "bestPractices": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "content": [
        "Keep state minimal - only store what's needed for rendering",
        "Use descriptive event names (increment vs click_increment)",
        "Handle nil state gracefully with ?? operator",
        "Validate user input in event handlers",
        "Use effects for client-side only operations",
        "Test LiveView components with integration tests"
      ]
    }
  }
}
