{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Soli MVC Controller Convention",
  "description": "Machine-readable conventions for Soli MVC controllers",
  "type": "object",
  "properties": {
    "naming": {
      "type": "object",
      "properties": {
        "class": {
          "type": "object",
          "properties": {
            "pattern": {"type": "string", "pattern": "^[A-Z][a-zA-Z]*Controller$"},
            "examples": ["UsersController", "PostsController", "Admin::UsersController"],
            "description": "PascalCase, singular, ends with Controller"
          }
        },
        "file": {
          "type": "object",
          "properties": {
            "pattern": {"type": "string", "pattern": "^[a-z_]+_controller\\.sl$"},
            "examples": ["users_controller.sl", "posts_controller.sl"],
            "description": "snake_case ending with _controller.sl"
          }
        }
      }
    },
    "baseClass": {
      "type": "object",
      "properties": {
        "name": {"type": "string", "enum": ["Controller"]},
        "location": {"type": "string"},
        "description": {"type": "string", "description": "Controllers must extend Controller base class"}
      }
    },
    "staticBlock": {
      "type": "object",
      "properties": {
        "layout": {
          "type": "string",
          "description": "Layout property set in static block",
          "examples": ["this.layout = \"application\""]
        },
        "beforeAction": {
          "type": "string",
          "description": "Callback before each action",
          "examples": ["this.before_action = fn(req) { /* logic */ }"]
        },
        "afterAction": {
          "type": "string",
          "description": "Callback after each action",
          "examples": ["this.after_action = fn(req, res) { /* logic */ }"]
        },
        "asyncSupported": {
          "type": "boolean",
          "description": "Controllers support async/await in action methods",
          "examples": ["async fn action(req: Any) -> Any { /* async code */ }"]
        }
      }
    },
    "methods": {
      "type": "object",
      "properties": {
        "signature": {
          "type": "object",
          "properties": {
            "sync": {
              "type": "string",
              "pattern": "^fn [a-z_]+\\(req: Any\\) -> Any$",
              "examples": ["fn index(req: Any) -> Any", "fn show(req: Any) -> Any"],
              "description": "All public methods take req: Any parameter and return Any"
            },
            "async": {
              "type": "string",
              "pattern": "^async fn [a-z_]+\\(req: Any\\) -> Any$",
              "examples": ["async fn fetch_data(req: Any) -> Any"],
              "description": "Async methods for I/O operations"
            },
            "withRestParams": {
              "type": "string",
              "pattern": "^fn [a-z_]+\\([^)]*\\.\\.\\.\\w+: \\w+\\[\\]\\) -> \\w+$",
              "examples": ["fn sum(...numbers: Int[]) -> Int"],
              "description": "Function with rest parameters"
            }
          }
        },
        "privatePrefix": {
          "type": "string",
          "pattern": "^_[a-z_]+$",
          "examples": ["_helper_method", "_process_params"],
          "description": "Private methods start with underscore"
        },
        "restActions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "enum": ["index", "show", "new", "create", "edit", "update", "destroy"]
              },
              "httpMethod": {"type": "string"},
              "path": {"type": "string", "examples": ["/posts", "/posts/:id", "/posts/new"]},
              "description": {"type": "string"}
            }
          }
        }
      }
    },
    "errorHandling": {
      "type": "object",
      "properties": {
        "tryCatch": {
          "type": "string",
          "description": "try/catch/throw for error handling",
          "examples": ["try { /* code */ } catch (e) { /* handle */ }"]
        },
        "errorTypes": {
          "type": "array",
          "items": {"type": "string"},
          "examples": ["Error", "ValueError", "TypeError", "KeyError", "IndexError", "RuntimeError"]
        },
        "throwSyntax": {
          "type": "string",
          "examples": ["throw \"error\"", "throw Error.new(\"message\", { code: 500 })"]
        }
      }
    },
    "destructuring": {
      "type": "object",
      "properties": {
        "hash": {
          "type": "string",
          "description": "Extract fields from hashes",
          "examples": ["let { id, name, email } = user;"]
        },
        "array": {
          "type": "string",
          "description": "Extract elements from arrays",
          "examples": ["let [first, ...rest] = array;"]
        },
        "nested": {
          "type": "string",
          "description": "Nested destructuring",
          "examples": ["let { user: { name, email }, posts } = data;"]
        },
        "inParams": {
          "type": "string",
          "description": "Destructuring in function parameters",
          "examples": ["fn process({ id, name, email }) -> Any { }"]
        }
      }
    },
    "responses": {
      "type": "object",
      "properties": {
        "render": {
          "type": "object",
          "properties": {
            "signature": {"type": "string", "examples": ["render(\"posts/index\", {\"posts\": posts})"]},
            "templatePath": {"type": "string", "examples": ["posts/index", "posts/show"]},
            "data": {"type": "string", "description": "Hash with template variables"}
          }
        },
        "json": {
          "type": "object",
          "properties": {
            "format": {"type": "string", "examples": ["{\"status\": 200, \"data\": data}"]},
            "contentType": {"type": "string", "enum": ["application/json"]}
          }
        },
        "redirect": {
          "type": "string",
          "examples": ["redirect(\"/posts\")", "redirect(\"/posts/\" + id)"],
          "description": "Return redirect URL string"
        },
        "raw": {
          "type": "object",
          "properties": {
            "status": {"type": "integer", "examples": [200, 201, 400, 404, 500]},
            "body": {"type": "string"},
            "headers": {"type": "object"}
          }
        }
      }
    },
    "modules": {
      "type": "object",
      "properties": {
        "import": {
          "type": "string",
          "examples": ["import \"modules/helpers\";", "import { func1, func2 } from \"modules/utils\";"]
        },
        "pub": {
          "type": "string",
          "description": "Export functions/classes from modules",
          "examples": ["pub fn helper() -> Any { }", "pub class Cache { }"]
        }
      }
    },
    "hashSpread": {
      "type": "object",
      "properties": {
        "syntax": {"type": "string", "examples": ["{ ...defaults, ...overrides }"]},
        "description": {"type": "string", "description": "Merge hashes using spread operator"}
      }
    }
  }
}
