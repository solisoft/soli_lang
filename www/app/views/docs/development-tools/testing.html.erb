<div class="max-w-3xl mx-auto">
    <div class="mb-16">
        <h1 class="text-4xl font-bold tracking-tight text-white sm:text-5xl mb-6">
            <span class="bg-gradient-to-r from-emerald-400 via-teal-400 to-cyan-400 bg-clip-text text-transparent">Testing</span>
        </h1>
        <p class="text-xl text-gray-300 leading-8">
            Soli provides a comprehensive testing framework for MVC applications with BDD-style DSL, parallel execution, and coverage reporting.
        </p>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">Test Structure</h2>
    <p class="text-gray-400 mb-4">Tests live in the <code>tests/</code> directory of your application:</p>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">Directory Layout</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-text text-sm">myapp/
├── app/
│   ├── controllers/
│   ├── models/
│   └── views/
└── tests/
    ├── users_spec.soli
    ├── posts_spec.soli
    └── integration/
        └── api_spec.soli</code></pre>
        </div>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">Test DSL</h2>

    <h3 class="text-xl font-semibold text-white mb-4">Basic Test Structure</h3>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">tests/users_spec.soli</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">describe("UsersController", fn() {
    test("creates a new user", fn() {
        # Test code here
        expect(true).to_be(true);
    });

    context("when valid", fn() {
        test("returns success", fn() {
            # Nested context
        });
    });
});</code></pre>
        </div>
    </div>

    <h3 class="text-xl font-semibold text-white mb-4">Available Functions</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-12">
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">describe(name, fn)</code>
            <p class="text-sm text-gray-400 mt-1">Group related tests</p>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">context(name, fn)</code>
            <p class="text-sm text-gray-400 mt-1">Group tests with conditions</p>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">test(name, fn)</code>
            <p class="text-sm text-gray-400 mt-1">Define a test case</p>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">before_each(fn)</code>
            <p class="text-sm text-gray-400 mt-1">Setup before each test</p>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">after_each(fn)</code>
            <p class="text-sm text-gray-400 mt-1">Teardown after each test</p>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">pending()</code>
            <p class="text-sm text-gray-400 mt-1">Skip a test</p>
        </div>
    </div>

    <h3 class="text-xl font-semibold text-white mb-4">Expectations</h3>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">Assertions</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">expect(value).to_equal(expected);
expect(value).to_be(expected);
expect(value).to_not_equal(other);
expect(value).to_be_null();
expect(value).to_not_be_null();
expect(value).to_be_greater_than(10);
expect(value).to_be_less_than(100);
expect(value).to_contain("substring");
expect(value).to_match(regex);
expect(hash).to_have_key("name");
expect(json_string).to_be_valid_json();</code></pre>
        </div>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">HTTP Integration Testing</h2>
    <p class="text-gray-400 mb-4">Make HTTP requests to test your endpoints:</p>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">tests/api_spec.soli</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">describe("Users API", fn() {
    test("GET /users returns list", fn() {
        let response = TestHTTP.get("/users");
        expect(response.status).to_equal(200);
        expect(response.body).to_contain("users");
    });

    test("POST /users creates user", fn() {
        let response = TestHTTP.post("/users", hash(
            "email": "test@example.com",
            "name": "Test User"
        ));
        expect(response.status).to_equal(201);
    });

    test("PUT /users/:id updates user", fn() {
        let response = TestHTTP.put("/users/1", hash("name": "Updated"));
        expect(response.status).to_equal(200);
    });

    test("DELETE /users/:id removes user", fn() {
        let response = TestHTTP.delete("/users/1");
        expect(response.status).to_equal(204);
    });
});</code></pre>
        </div>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">Controller Testing</h2>
    <p class="text-gray-400 mb-4">Call controller actions directly with mocked context:</p>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">tests/controllers_spec.soli</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">describe("UsersController", fn() {
    before_each(fn() {
        Factory.clear();
    });

    test("create action", fn() {
        let result = ControllerTest.helpers.users_controller.create(
            params: hash("email": "test@example.com"),
            session: Session.new(),
            headers: Headers.new()
        );
        expect(result.status).to_equal(201);
    });

    test("show action", fn() {
        let user = Factory.create("user");
        let result = ControllerTest.helpers.users_controller.show(
            params: hash("id": user.id),
            session: Session.new(),
            headers: Headers.new()
        );
        expect(result.status).to_equal(200);
    });
});</code></pre>
        </div>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">Database Testing</h2>

    <h3 class="text-xl font-semibold text-white mb-4">Transaction Rollback</h3>
    <p class="text-gray-400 mb-4">Tests are isolated using database transactions:</p>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">tests/models_spec.soli</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">describe("User model", fn() {
    test("creates user", fn() {
        with_transaction(fn() {
            let user = Factory.create("user", hash("name": "Test"));
            expect(User.count()).to_equal(1);
            expect(user.name).to_equal("Test");
        });
        # Transaction automatically rolls back
    });
});</code></pre>
        </div>
    </div>

    <h3 class="text-xl font-semibold text-white mb-4">Factory Pattern</h3>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">Using Factories</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm"># Define factories
Factory.define("user", hash(
    "email": "user@example.com",
    "name": "Test User"
));

Factory.define("post", hash(
    "title": "Test Post",
    "content": "Content here"
));

# Use factories
let user = Factory.create("user");
let post = Factory.create("post", hash("title": "Custom Title"));
let users = Factory.create_list("user", 5);</code></pre>
        </div>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">Parallel Execution</h2>
    <p class="text-gray-400 mb-4">Tests run in parallel by default:</p>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">CLI Options</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-bash text-sm">soli test                    # Parallel (default)
soli test --jobs=4           # 4 workers
soli test --jobs=1           # Sequential (debug)</code></pre>
        </div>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">Coverage Reporting</h2>
    <p class="text-gray-400 mb-4">Generate coverage reports for your tests:</p>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">Coverage Output</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-text text-sm">Coverage: 87.5% (1250/1428 lines) ✓

src/controllers/users.soli     ▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░  94.2%
src/models/user.soli           ▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░  91.1%
src/controllers/posts.soli     ▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░  78.5%</code></pre>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-12">
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">--coverage</code>
            <p class="text-sm text-gray-400 mt-1">Generate coverage report</p>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">--coverage=html</code>
            <p class="text-sm text-gray-400 mt-1">HTML report</p>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">--coverage=json</code>
            <p class="text-sm text-gray-400 mt-1">JSON for CI</p>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <code class="text-emerald-300 font-bold">--coverage-min=80</code>
            <p class="text-sm text-gray-400 mt-1">Fail if < 80%</p>
        </div>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">Complete Example</h2>

    <div class="rounded-xl bg-gray-950 ring-1 ring-white/10 overflow-hidden shadow-xl mb-12">
        <div class="px-4 py-2 border-b border-white/5 bg-white/5 flex items-center justify-between">
            <span class="text-xs text-gray-400 font-mono">tests/users_spec.soli</span>
        </div>
        <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">describe("UsersController", fn() {
    before_each(fn() {
        Factory.clear();
        Database.clean_all();
    });

    context("POST /users", fn() {
        test("creates user with valid data", fn() {
            let response = TestHTTP.post("/users", hash(
                "email": "user@example.com",
                "name": "Test User"
            ));
            expect(response.status).to_equal(201);
            expect(response.body).to_contain("Test User");
        });

        test("returns 422 with invalid email", fn() {
            let response = TestHTTP.post("/users", hash(
                "email": "invalid-email"
            ));
            expect(response.status).to_equal(422);
        });
    });

    context("GET /users/:id", fn() {
        test("shows user profile", fn() {
            let user = Factory.create("user");
            let response = TestHTTP.get("/users/" + user.id);
            expect(response.status).to_equal(200);
            expect(response.body).to_contain(user.name);
        });

        test("returns 404 for unknown user", fn() {
            let response = TestHTTP.get("/users/99999");
            expect(response.status).to_equal(404);
        });
    });
});</code></pre>
        </div>
    </div>

    <div class="my-8 p-6 rounded-xl bg-emerald-500/10 border border-emerald-500/20 mb-12">
        <h4 class="text-lg font-semibold text-emerald-400 mb-2 flex items-center gap-2">
            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.854 1.5-2.269a6.002 6.002 0 00-2.25-10.428m0 0a6.002 6.002 0 012.25-10.428M14.25 18a6.002 6.002 0 01-2.25 10.428m2.25-10.428v-.192c0-.983-.658-1.854-1.5-2.269" />
            </svg>
            Best Practice
        </h4>
        <p class="text-emerald-200/80">
            Write tests as you develop. Following TDD (Test-Driven Development) helps catch bugs early and improves code design.
        </p>
    </div>

    <h2 class="text-2xl font-bold text-white mb-6">Next Steps</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <a href="/docs/models" class="group block p-6 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-emerald-500/50 transition-all">
            <h3 class="text-lg font-semibold text-white mb-2 group-hover:text-emerald-400 transition-colors">Models &rarr;</h3>
            <p class="text-sm text-gray-400">Learn about data modeling and database operations.</p>
        </a>
        <a href="/docs/routing" class="group block p-6 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-emerald-500/50 transition-all">
            <h3 class="text-lg font-semibold text-white mb-2 group-hover:text-emerald-400 transition-colors">Routing &rarr;</h3>
            <p class="text-sm text-gray-400">Define your application's URLs and handlers.</p>
        </a>
    </div>
</div>
