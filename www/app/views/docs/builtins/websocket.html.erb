<div>
    <!-- Hero Section -->
    <div class="mb-16">
        <h1 class="text-4xl font-bold tracking-tight text-white sm:text-5xl mb-6">
            <span class="bg-gradient-to-r from-fuchsia-400 via-purple-400 to-indigo-400 bg-clip-text text-transparent">WebSocket Functions</span>
        </h1>
        <p class="text-xl text-gray-300 leading-8">
            Built-in functions for WebSocket messaging, presence tracking, and room management. Build real-time chat, notifications, and collaborative features.
        </p>
    </div>

    <!-- Quick Navigation -->
    <nav class="not-prose mb-12">
        <div class="flex flex-wrap gap-2">
            <a href="#messaging" class="px-3 py-1.5 text-sm rounded-full bg-white/5 border border-white/10 text-gray-300 hover:text-white hover:border-fuchsia-500/50 transition-all">Messaging</a>
            <a href="#presence" class="px-3 py-1.5 text-sm rounded-full bg-white/5 border border-white/10 text-gray-300 hover:text-white hover:border-fuchsia-500/50 transition-all">Presence</a>
            <a href="#connection" class="px-3 py-1.5 text-sm rounded-full bg-white/5 border border-white/10 text-gray-300 hover:text-white hover:border-fuchsia-500/50 transition-all">Connection</a>
        </div>
    </nav>

    <!-- Messaging Functions -->
    <section id="messaging" class="mb-16">
        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
            <svg class="w-7 h-7 text-fuchsia-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
            </svg>
            Messaging Functions
        </h2>

        <!-- ws_send -->
        <div class="rounded-xl bg-white/5 border border-white/10 p-6 mb-6">
            <h3 class="text-lg font-bold text-white mb-2 font-mono">ws_send(connection_id, message)</h3>
            <p class="text-gray-400 mb-4">Send a message to a specific WebSocket connection.</p>
            <div class="rounded-lg bg-gray-900 overflow-hidden">
                <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">// Send to specific client
ws_send("uuid-1234", json_encode({ "type": "notification", "text": "Hello!" }));</code></pre>
                </div>
            </div>
            <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
                <div>
                    <span class="text-gray-500">Parameters:</span>
                    <ul class="mt-1 text-gray-400">
                        <li><code class="text-fuchsia-300">connection_id</code> - Target connection UUID</li>
                        <li><code class="text-fuchsia-300">message</code> - String message to send</li>
                    </ul>
                </div>
                <div>
                    <span class="text-gray-500">Returns:</span>
                    <span class="text-gray-400 ml-2">null</span>
                </div>
            </div>
        </div>

        <!-- ws_broadcast -->
        <div class="rounded-xl bg-white/5 border border-white/10 p-6 mb-6">
            <h3 class="text-lg font-bold text-white mb-2 font-mono">ws_broadcast(message)</h3>
            <p class="text-gray-400 mb-4">Broadcast a message to ALL connected WebSocket clients.</p>
            <div class="rounded-lg bg-gray-900 overflow-hidden">
                <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">// Announce to everyone
ws_broadcast(json_encode({ "type": "announcement", "text": "Server restarting in 5 minutes" }));</code></pre>
                </div>
            </div>
            <div class="mt-4 p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/20">
                <p class="text-yellow-200/80 text-sm">
                    <strong>Performance note:</strong> Broadcasting to thousands of clients is expensive. Prefer <code>ws_broadcast_room</code> when possible.
                </p>
            </div>
        </div>

        <!-- ws_broadcast_room -->
        <div class="rounded-xl bg-white/5 border border-white/10 p-6 mb-6">
            <h3 class="text-lg font-bold text-white mb-2 font-mono">ws_broadcast_room(channel, message)</h3>
            <p class="text-gray-400 mb-4">Broadcast a message to all clients in a specific channel/room.</p>
            <div class="rounded-lg bg-gray-900 overflow-hidden">
                <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">// Send to room members only
ws_broadcast_room("room:lobby", json_encode({
    "type": "chat",
    "user": "Alice",
    "text": "Hello room!"
}));</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Presence Functions -->
    <section id="presence" class="mb-16">
        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
            <svg class="w-7 h-7 text-green-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
            </svg>
            Presence Functions
        </h2>
        <p class="text-gray-400 mb-6">
            Query presence state from your handlers. Presence is automatically tracked via handler actions (<code>track</code>, <code>untrack</code>, <code>set_presence</code>).
        </p>

        <!-- ws_list_presence -->
        <div class="rounded-xl bg-white/5 border border-white/10 p-6 mb-6">
            <h3 class="text-lg font-bold text-white mb-2 font-mono">ws_list_presence(channel)</h3>
            <p class="text-gray-400 mb-4">Get all users present in a channel, grouped by user_id with their connection metas.</p>
            <div class="rounded-lg bg-gray-900 overflow-hidden">
                <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">let users = ws_list_presence("room:lobby");
// Returns: [
//   {
//     user_id: "123",
//     metas: [
//       { connection_id: "uuid-1", phx_ref: "1", state: "online", name: "Alice" },
//       { connection_id: "uuid-2", phx_ref: "2", state: "typing", name: "Alice" }
//     ]
//   },
//   { user_id: "456", metas: [{ connection_id: "uuid-3", state: "online", name: "Bob" }] }
// ]

// Count unique users
let user_count = array_len(users);

// Get all who are typing
let typing = array_filter(users, fn(u) {
    array_any(u["metas"], fn(m) { m["state"] == "typing" })
});</code></pre>
                </div>
            </div>
        </div>

        <!-- ws_presence_count -->
        <div class="rounded-xl bg-white/5 border border-white/10 p-6 mb-6">
            <h3 class="text-lg font-bold text-white mb-2 font-mono">ws_presence_count(channel)</h3>
            <p class="text-gray-400 mb-4">Get the number of unique users in a channel (not connection count).</p>
            <div class="rounded-lg bg-gray-900 overflow-hidden">
                <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">let count = ws_presence_count("room:lobby");
// Returns: 5 (unique users, even if they have multiple tabs open)</code></pre>
                </div>
            </div>
        </div>

        <!-- ws_get_presence -->
        <div class="rounded-xl bg-white/5 border border-white/10 p-6 mb-6">
            <h3 class="text-lg font-bold text-white mb-2 font-mono">ws_get_presence(channel, user_id)</h3>
            <p class="text-gray-400 mb-4">Get a specific user's presence in a channel, or null if not present.</p>
            <div class="rounded-lg bg-gray-900 overflow-hidden">
                <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">let alice = ws_get_presence("room:lobby", "user_123");
if (alice != null) {
    // Returns: { user_id: "user_123", metas: [...] }
    let is_typing = array_any(alice["metas"], fn(m) { m["state"] == "typing" });
    let connection_count = array_len(alice["metas"]);
}</code></pre>
                </div>
            </div>
        </div>

        <!-- Presence Meta Fields -->
        <div class="rounded-xl bg-indigo-500/10 border border-indigo-500/20 p-6 mb-6">
            <h4 class="text-lg font-semibold text-indigo-400 mb-3">Presence Meta Fields</h4>
            <p class="text-gray-400 mb-4">Each meta in the <code>metas</code> array contains:</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                <div class="p-3 rounded bg-white/5">
                    <code class="text-indigo-300">connection_id</code>
                    <span class="text-gray-400 ml-2">UUID of this specific connection</span>
                </div>
                <div class="p-3 rounded bg-white/5">
                    <code class="text-indigo-300">phx_ref</code>
                    <span class="text-gray-400 ml-2">Unique ref for diff tracking</span>
                </div>
                <div class="p-3 rounded bg-white/5">
                    <code class="text-indigo-300">state</code>
                    <span class="text-gray-400 ml-2">"online", "away", "typing", or custom</span>
                </div>
                <div class="p-3 rounded bg-white/5">
                    <code class="text-indigo-300">online_at</code>
                    <span class="text-gray-400 ml-2">Unix timestamp when joined</span>
                </div>
                <div class="p-3 rounded bg-white/5 md:col-span-2">
                    <code class="text-indigo-300">+ extra fields</code>
                    <span class="text-gray-400 ml-2">Any additional fields provided in <code>track</code> action (name, avatar, etc.)</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Connection Functions -->
    <section id="connection" class="mb-16">
        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
            <svg class="w-7 h-7 text-blue-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244" />
            </svg>
            Connection Functions
        </h2>

        <!-- ws_close -->
        <div class="rounded-xl bg-white/5 border border-white/10 p-6 mb-6">
            <h3 class="text-lg font-bold text-white mb-2 font-mono">ws_close(connection_id, reason)</h3>
            <p class="text-gray-400 mb-4">Forcefully close a WebSocket connection with a reason message.</p>
            <div class="rounded-lg bg-gray-900 overflow-hidden">
                <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">// Kick a user
ws_close("uuid-1234", "You have been disconnected by an admin");</code></pre>
                </div>
            </div>
        </div>

        <!-- ws_count -->
        <div class="rounded-xl bg-white/5 border border-white/10 p-6 mb-6">
            <h3 class="text-lg font-bold text-white mb-2 font-mono">ws_count()</h3>
            <p class="text-gray-400 mb-4">Get the total number of active WebSocket connections.</p>
            <div class="rounded-lg bg-gray-900 overflow-hidden">
                <div class="p-4 overflow-x-auto">
<pre><code class="language-soli text-sm">let total_connections = ws_count();</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Handler Actions Reference -->
    <section class="mb-16">
        <h2 class="text-2xl font-bold text-white mb-6">Handler Actions Reference</h2>
        <p class="text-gray-400 mb-6">
            WebSocket handlers return action hashes. These are processed by the runtime.
        </p>
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b border-white/10">
                        <th class="text-left py-3 px-4 text-gray-400 font-medium">Action</th>
                        <th class="text-left py-3 px-4 text-gray-400 font-medium">Type</th>
                        <th class="text-left py-3 px-4 text-gray-400 font-medium">Description</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    <tr>
                        <td class="py-3 px-4"><code class="text-green-300">join</code></td>
                        <td class="py-3 px-4 text-gray-400">string</td>
                        <td class="py-3 px-4 text-gray-400">Subscribe connection to a channel</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4"><code class="text-red-300">leave</code></td>
                        <td class="py-3 px-4 text-gray-400">string</td>
                        <td class="py-3 px-4 text-gray-400">Unsubscribe from a channel</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4"><code class="text-purple-300">send</code></td>
                        <td class="py-3 px-4 text-gray-400">string</td>
                        <td class="py-3 px-4 text-gray-400">Send message to this connection only</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4"><code class="text-indigo-300">broadcast</code></td>
                        <td class="py-3 px-4 text-gray-400">string</td>
                        <td class="py-3 px-4 text-gray-400">Send to all connections</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4"><code class="text-blue-300">broadcast_room</code></td>
                        <td class="py-3 px-4 text-gray-400">string</td>
                        <td class="py-3 px-4 text-gray-400">Send to all in joined channel</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4"><code class="text-orange-300">close</code></td>
                        <td class="py-3 px-4 text-gray-400">string</td>
                        <td class="py-3 px-4 text-gray-400">Close connection with reason</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4"><code class="text-emerald-300">track</code></td>
                        <td class="py-3 px-4 text-gray-400">hash</td>
                        <td class="py-3 px-4 text-gray-400">Start presence tracking. Requires <code>channel</code> and <code>user_id</code>.</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4"><code class="text-rose-300">untrack</code></td>
                        <td class="py-3 px-4 text-gray-400">string</td>
                        <td class="py-3 px-4 text-gray-400">Stop presence tracking in channel</td>
                    </tr>
                    <tr>
                        <td class="py-3 px-4"><code class="text-yellow-300">set_presence</code></td>
                        <td class="py-3 px-4 text-gray-400">hash</td>
                        <td class="py-3 px-4 text-gray-400">Update presence state. Requires <code>channel</code> and <code>state</code>.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Related Links -->
    <div class="rounded-2xl bg-gradient-to-br from-fuchsia-500/10 via-purple-500/10 to-indigo-500/10 border border-fuchsia-500/20 p-8">
        <h3 class="text-xl font-bold text-white mb-4">Related Documentation</h3>
        <div class="flex flex-wrap gap-4">
            <a href="/docs/core-concepts/websockets" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 hover:text-white transition-colors border border-white/10">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                </svg>
                WebSocket Guide
            </a>
            <a href="/docs/builtins/json" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 hover:text-white transition-colors border border-white/10">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                </svg>
                JSON Functions
            </a>
            <a href="/websocket" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-medium transition-colors">
                <span class="relative flex h-2 w-2">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-white"></span>
                </span>
                Live Demo
            </a>
        </div>
    </div>
</div>
